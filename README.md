# GoLedger Besu Challenge

This project is a backend Go application that interacts with a Hyperledger Besu private blockchain and a PostgreSQL database.

It provides a REST API to:
- `SET` a value in the smart contract
- `GET` the current value from the smart contract
- `SYNC` the blockchain value to the SQL database
- `CHECK` if the blockchain value matches the latest database record

---

## Project Structure

goledger-challenge-besu/
├── app/ # Go application (REST API)
│ ├── main.go
│ ├── handlers/
│ ├── services/
│ ├── test/
│ ├── .env
│ ├── docker-compose.yml # PostgreSQL setup
│ └── scripts/init.sql # DB table creation
├── besu/ # Besu network configuration
│ ├── artifacts/ # Smart contract ABI
│ └── startDev.sh # Starts Besu network



---

## Requirements

- Docker and Docker Compose
- Go 1.20+
- Git
- Node (NPM and NPX)
- HardHat
- Besu Network
- Unix based OS or WSL conncetion on Windows

---

##  Setup & Run

### 1. Clone the Project

```bash
git clone https://github.com/ksn123/goledger-challenge-besu.git
cd goledger-challenge-besu

```
### 2. Start Besu Network

```bash

cd besu
npm install
chmod +x startDev.sh
sudo ./startDev.sh

```
if your ./startDev.sh isn't getting the correct besu/hardhat path

```bash
sudo env "PATH=$PATH" ./startDev.sh

```
This will:

Start a local Besu private network with the smart contract deployed

Create the ABI JSON at: besu/artifacts/contracts/SimpleStorage.sol/SimpleStorage.json

Output the contract address to ignition/deployments/chain-1337/deployed_addresses.json

Copy the contract address and set it in .env later.


### 3. Configure Environment


Edit app/.env:

BESU_RPC_URL= http://localhost:8545 or your url
CONTRACT_ADDRESS= "The contract address generated by ./startDev.sh" common path > /besu/ignition/deployments/chain-1337/deployed_addresses.json
ABI_JSON="absolute-path/goledger-challenge-besu/besu/artifacts/contracts/SimpleStorage.sol/SimpleStorage.json" make sure that is the absolute json path
PRIVATE_KEY= "The private key that was generated by ./startDev.sh" common path > /besu/ignition/deployments/chain-1337/deployed_addresses.json /besu/genesis/genesis.json
DB_HOST=localhost
DB_PORT=5433 or 5432
DB_USER=postgres
DB_PASSWORD="your postgress password"
DB_NAME=besu_data

### 4. Configure the DATABASE

IF you're running the docker in a unix-based OS:

```bash
cd ../app
docker compose up -d
```

IF you're running in a WSL conncection on Windows to a Ubuntu (ex):

```bash
sudo -i -u postgres
psql
CREATE DATABASE besu_data; ## or the Database name that is in .env
exit
```
Now create the table:

```bash
psql -h localhost -p 5433 -U postgres -d besu_data -f scripts/init.sql

```

# 5. Running the app

```bash

go mod tidy
go run main.go

```

The API will be available at: http://localhost:8080

API ENDPOINTS

| Method | Endpoint | Description                                |
| ------ | -------- | ------------------------------------------ |
| GET    | `/get`   | Read current contract value                |
| POST   | `/set`   | Set a new value in the contract            |
| POST   | `/sync`  | Sync the value from blockchain to database |
| GET    | `/check` | Compare blockchain value with DB           |

Example: 
curl -X POST http://localhost:8080/set
curl -X GET http://localhost:8080/get
curl -X POST http://localhost:8080/sync
curl -X POST http://localhost:8080/check


Running Unit Tests

```bash
cd app
go test ./... -v
```
Ensure .env is loaded and Besu/Postgres are running.

Architecture Overview
Smart Contract: SimpleStorage (set(uint256), get())

Go REST API:

services/: handles blockchain + DB logic

handlers/: HTTP layer

Database:

contract_state table

Stores the last synced value with a timestamp

Integration:

Calls Ethereum JSON-RPC via go-ethereum

Uses database/sql and github.com/lib/pq for PostgreSQL

Authors
Forked from: GoLedgerDev/goledger-challenge-besu

Developed by: Kleison (ksn123)

